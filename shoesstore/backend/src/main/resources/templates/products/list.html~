
  <div class="content card shadow">

    <!-- Mensaje de error -->
    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show mt-3">
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="card-header bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="h4 mb-0">Gestión de Stock</h1>
        <span class="badge bg-light text-primary" th:text="${products.size()} + ' productos'"></span>
      </div>
    </div>

    <div class="card-body">
      <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <div class="search-container flex-grow-1 me-3" style="max-width: 500px;">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input type="text" id="buscador" class="form-control form-control-lg"
                   placeholder="Buscar por código, descripción, marca..." autocomplete="off">
          </div>
        </div>
        <a th:href="@{/products/new}" class="btn btn-primary btn-lg mt-3 flex-shrink-0">
          <i class="bi bi-plus-circle me-2"></i>Nuevo Producto
        </a>
      </div>

      <!-- Tabla de productos -->
      <div class="table-responsive">
        <table class="table table-hover align-middle" id="tablaProductos">
          <thead class="table-light">
          <tr>
            <th class="py-3">Código</th>
            <th class="py-3">Descripción</th>
            <th class="py-3">Marca</th>
            <th class="py-3 text-center">Talle</th>
            <th class="py-3 text-end">Precio</th>
            <th class="py-3">Proveedores</th>
            <th class="py-3 text-center">Stock</th>
            <th class="py-3 text-end">Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="product : ${products}" class="product-row">
            <td th:text="${product.id}" class="fw-semibold"></td>
            <td>
              <div class="fw-medium" th:text="${product.description}"></div>
              <div class="text-muted small">
                <span th:text="${product.color}"></span> ·
                <span th:text="${product.genderDisplay}"></span> ·
                <span th:text="${product.type}"></span> ·
                <span th:text="${product.material}"></span>
              </div>
            </td>
            <td th:text="${product.brand}"></td>
            <td th:text="${product.size.displayValue}" class="text-center"></td>
            <td th:text="${product.formattedPrice}" class="text-end"></td>
            <td>
              <div th:if="${not #lists.isEmpty(product.supplierNames)}">
                <div class="d-flex flex-wrap gap-1">
                  <span th:each="supplier : ${product.supplierNames}"
                        class="badge bg-light text-dark border">
                    <i class="bi bi-building me-1"></i>
                    <span th:text="${supplier}"></span>
                  </span>
                </div>
              </div>
              <span th:if="${#lists.isEmpty(product.supplierNames)}"
                    class="text-muted small">Sin proveedores</span>
            </td>
            <td class="text-center">
              <span th:class="${product.stock <= 5 ? 'text-danger fw-bold' :
                               product.stock <= 15 ? 'text-warning fw-bold' :
                               'text-success fw-bold'}"
                    th:text="${product.stock}">
              </span>
            </td>
            <td class="text-end">
              <div class="d-flex gap-1 justify-content-end">
                <a th:href="@{/products/edit/{id}(id=${product.id})}"
                   class="btn btn-sm btn-warning">
                  <i class="bi bi-pencil"></i>
                </a>
                <form th:action="@{/products/{id}(id=${product.id})}" method="post" class="d-inline">
                  <input type="hidden" name="_method" value="DELETE">
                  <button type="submit"
                          class="btn btn-sm btn-danger"
                          onclick="return confirm('¿Desea eliminar este producto permanentemente, en ese caso se quitarán los mismos de todos los proveedores relacionados?')">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
          <tr th:if="${products.empty}" class="empty-row">
            <td colspan="8" class="text-center py-5">
              <div class="d-flex flex-column align-items-center">
                <i class="bi bi-box-seam display-4 text-muted mb-3"></i>
                <h4 class="mb-2">No hay productos registrados</h4>
                <p class="text-muted">Comienza agregando un nuevo producto</p>
                <a th:href="@{/products/new}" class="btn btn-primary mt-2">
                  <i class="bi bi-plus-circle me-2"></i>Agregar Producto
                </a>
              </div>
            </td>
          </tr>
          <tr class="no-results-row" style="display: none;">
            <td colspan="8" class="text-center py-5">
              <div class="d-flex flex-column align-items-center">
                <i class="bi bi-search display-4 text-muted mb-3"></i>
                <h4 class="mb-2">No se encontraron productos</h4>
                <p class="text-muted">Intenta con otro término de búsqueda</p>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const buscador = document.getElementById('buscador');
      const tabla = document.getElementById('tablaProductos');
      const productRows = tabla.querySelectorAll('tbody tr.product-row');
      const noResultsRow = tabla.querySelector('tr.no-results-row');
      const emptyRow = tabla.querySelector('tr.empty-row');

      if (buscador) {
        buscador.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase().trim();
          let visibleCount = 0;

          if (emptyRow) emptyRow.style.display = 'none';

          productRows.forEach(row => {
            const rowText = Array.from(row.cells)
                    .map(cell => cell.textContent.toLowerCase())
                    .join(' ');

            if (rowText.includes(searchTerm)) {
              row.style.display = '';
              visibleCount++;
            } else {
              row.style.display = 'none';
            }
          });

          if (searchTerm && visibleCount === 0) {
            noResultsRow.style.display = '';
          } else {
            noResultsRow.style.display = 'none';
          }
        });
      }
    });
  </script>
</div>

<script>
  function filtrarProductos() {
    var input = document.getElementById("buscador");
    var filter = input.value.toUpperCase();
    var table = document.getElementById("tablaProductos");
    var tr = table.getElementsByTagName("tr");
    let visibleCount = 0;

    for (var i = 1; i < tr.length; i++) {
      var tds = tr[i].getElementsByTagName("td");
      var mostrarFila = false;

      // Buscar en todas las columnas excepto acciones
      for (var j = 0; j < tds.length - 1; j++) {
        if (tds[j]) {
          var txtValue = tds[j].textContent || tds[j].innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            mostrarFila = true;
            break;
          }
        }
      }

      if (mostrarFila) {
        tr[i].style.display = "";
        visibleCount++;
      } else {
        tr[i].style.display = "none";
      }
    }

    // Actualizar contador
    const badge = document.querySelector('.badge.bg-light.text-primary');
    if (badge) {
      badge.textContent = visibleCount + ' productos';
    }
  }

  // Agregar evento al buscador
  document.getElementById('buscador').addEventListener('input', filtrarProductos);
</script>

<style>

  .card-header.bg-primary {
    border-radius: 0.75rem 0.75rem 0 0;
    padding: 1.25rem 1.5rem;
  }

  .table-hover tbody tr {
    transition: all 0.2s ease;
  }

  .table-hover tbody tr:hover {
    background-color: rgba(67, 97, 238, 0.05);
  }

  .search-container .input-group-text {
    background: white;
    border-right: none;
  }

  .search-container .form-control {
    border-left: none;
  }

  .hover-shadow {
    transition: box-shadow 0.3s ease;
  }

  .hover-shadow:hover {
    box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
  }
</style>